<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.king.test.usecaseManage.usecaseExecution.mapper.TfUsecaseExecutionHistoryMapper">

    <!-- 查询历史执行记录列表 -->
    <select id="selectExecutionHistoryList" resultType="com.king.test.usecaseManage.usecaseExecution.entity.TfUsecaseExecutionHistory">
        SELECT
            h.USECASE_EXECUTION_HISTORY_ID AS usecaseExecutionHistoryId,
            h.DIRECTORY_ID AS directoryId,
            h.USECASE_ID AS usecaseId,
            h.EXECUTION_TIME AS executionTime,
            h.RUN_STATUS AS runStatus,
            dic_status.DATA_NAME AS runStatusName,
            h.EXECUTOR_ID AS executorId,
            executor.USER_NAME AS executorName,
            h.REMARK AS remark,
            att.ATTACHMENT_ID AS attachmentId,
            att.ORIGINAL_FILE_NAME AS originalFileName,
            h.RUN_TYPE AS runType,
            dic_runType.DATA_NAME AS runTypeName
        FROM tf_usecase_execution_history h
        LEFT JOIN t_sys_user executor ON h.EXECUTOR_ID = executor.USER_ID
        LEFT JOIN tf_attachment att ON h.USECASE_EXECUTION_HISTORY_ID = att.RELATE_ID AND att.MODULE = 'usecaseExecution'
        LEFT JOIN data_dictionary dic_status ON dic_status.DATA_TYPE = 'runStatus' AND dic_status.DATA_VALUE = h.RUN_STATUS
        LEFT JOIN data_dictionary dic_runType ON dic_runType.DATA_TYPE = 'runType' AND dic_runType.DATA_VALUE = h.RUN_TYPE
        <where>
            <if test="directoryId != null and directoryId != ''">
                AND h.DIRECTORY_ID = #{directoryId}
            </if>
            <if test="usecaseId != null and usecaseId != ''">
                AND h.USECASE_ID = #{usecaseId}
            </if>
        </where>
        ORDER BY h.EXECUTION_TIME DESC
    </select>

</mapper>
