<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.king.framework.attachment.mapper.AttachmentMapper">

    <!-- 根据模块和关联ID查询附件列表（关联用户表查询上传用户姓名） -->
    <select id="selectAttachmentsWithUserName" resultType="com.king.framework.attachment.entity.TfAttachment">
        SELECT
            a.ATTACHMENT_ID AS attachmentId,
            a.ORIGINAL_FILE_NAME AS originalFileName,
            a.SERVER_FILE_NAME AS serverFileName,
            a.ATTACHMENT_SIZE AS attachmentSize,
            a.UPLOAD_DATE AS uploadDate,
            a.UPLOAD_USER_ID AS uploadUserId,
            u.USER_NAME AS uploadUserName,
            a.UPLOAD_PATH AS uploadPath,
            a.MODULE AS module,
            a.RELATE_ID AS relateId
        FROM tf_attachment a
        LEFT JOIN t_sys_user u ON a.UPLOAD_USER_ID = u.USER_ID
        <where>
            <if test="module != null and module != ''">
                AND a.MODULE = #{module}
            </if>
            <if test="relateId != null and relateId != ''">
                AND a.RELATE_ID = #{relateId}
            </if>
        </where>
        ORDER BY a.UPLOAD_DATE DESC
    </select>

</mapper>
